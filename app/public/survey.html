<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="assets/css/reset.css"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="assets/css/style.css"> -->
    <link rel="icon" type="favicon" href="">
    <title>Survey</title>
</head>

<body>
    <header>
        <nav class="navbar navbar-light bg-dark mb-3">
            <a class="navbar-brand text-light" href="./survey">Friendship Survey</a>
            <div class="text-light" id="theme">Instructions: Type your name, and rate how strongly you agree with the following 10 statements.</div>
        </nav>

    </header>
    <div class="container">
        <form class="form-group">
            What is your name?
            <br>
            <input type="text" id="userName" name="name">
            <br>
            Image URL (full link):
            <br>
            <input type="text" id="userImage" name="image">
            <br>
            <h2>Questions:</h2>
            LeBron James is the best basketball player currently playing in the NBA.
            <br>
            <select class="bg-secondary text-light m-3" id="one" name="bball">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> To travel long distances, I would prefer to fly.
            <br>
            <select class="bg-secondary text-light m-3" id="two" name="fly">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> It is better to be loved than feared.
            <br>
            <select class="bg-secondary text-light m-3" id="three" name="love">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> The city is preferable to live over rural areas.
            <br>
            <select class="bg-secondary text-light m-3" id="four" name="cities">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> The West Coast is a better place to live over the East Coast.
            <br>
            <select class="bg-secondary text-light m-3" id="five" name="coast">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> As my personal vehicle, I would rather drive an SUV over a car.
            <br>
            <select class="bg-secondary text-light m-3" id="six" name="cars">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> Dogs are better than Cats.
            <br>
            <select class="bg-secondary text-light m-3" id="seven" name="dogs">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br>On Saturday nights, I would rather go to the club or bar than attend a game night.
            <br>
            <select class="bg-secondary text-light m-3" id="eight" name="club">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> While walking inside my home, I wear shoes I also wear outside the house.
            <br>
            <select class="bg-secondary text-light m-3" id="nine" name="shoes">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>
            </select>
            <br> I pronounce the term JSON as "Jason"
            <br>
            <select class="bg-secondary text-light m-3" id="ten" name="json">
                <option value="1">1 - Strongly Disagree</option>
                <option value="2">2 - Somewhat Disagree</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Somewhat Agree</option>
                <option value="5">5 - Strongly Agree</option>

            </select>
            <br>

            <input class="btn btn-success" data-toggle="modal" data-target="#theModal" id="pushIt" type="submit">


        </form>
<!-- Modal -->
<div class="modal fade" id="theModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Your Friend Match!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="friendMatched">
              
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

        <script>
          
            $("#pushIt").on("click", function (event) {
                event.preventDefault();
                var userName = $("#userName").val().trim();
                var userImage = $("#userImage").val().trim();
                var newArr = []
                newArr.push(parseInt($("#one").val()), parseInt($("#two").val()), parseInt($("#three").val()),
                    parseInt($("#four").val()), parseInt($("#five").val()), parseInt($("#six").val()),
                    parseInt(
                        $("#seven").val()), parseInt($("#eight").val()), parseInt($("#nine").val()),
                    parseInt($(
                        "#ten").val()))


                var newObj = {
                    name: userName,
                    image: userImage,
                    score: newArr
                };


                $.post("/api/friends", newObj,
                    function (data) {

                        query();
                        
                    })
               
            });

            function query() {
                var currentURL = window.location.origin;
                $.ajax({
                        url: currentURL + "/api/friends",
                        method: "GET"
                    })
                    .then(function (data) {
                        var sumArr = [];
                        var arr = [];
                        var diff = [];
                        var sum = 0;
                        var a = 0;
                        for (i = 0; i < data.length; i++) {
                            arr[i] = [];
                            for (j = 0; j < data[i].score.length; j++) {
                                arr[i].push(parseInt(data[i].score[j]))
                            }
                        }
                        for (i = 0; i < data.length - 1; i++) {
                            diff[i] = [];
                            
                            for (j = 0; j < 10; j++) {
                                diff[i].push(Math.abs(arr[i][j] - arr[data.length - 1][j]))
                            }
                            for (j = 0; j < 10; j++) {
                                sum+=diff[i][j]
                            }
                            sumArr.push(sum)
                            sum = 0;
                        }
                        console.log(sumArr)
                        
                        for(j=0;j<=40;j++){
                        for(i=0;i<sumArr.length;i++) {
                                if(sumArr[i]===j) {
                                 var a = i;
                                 post(currentURL, a);
                                 return a
                                }
                            }
                        }
                        
                    });
            }
        function post(currentURL, a) {
            $.ajax({
                        url: currentURL + "/api/friends",
                        method: "GET"
                    }).then(function (data) {
                        
                        
                        document.getElementById("friendMatched").innerHTML = data[a].name + "<br> <img src='" + data[a].image + "'>"
                    
        })}
        </script>
    </div>
</body>

</html>